# 세션/쿠키 기반
## 인증을 사용하는 이유
- 서버에서는 모든 API 요청에 대해 사용자를 확인하는 작업을 해야한다.
- 사용자가 두 명 이상이라면 서버 자체만으로는 구별을 하기 힘들어 타인에게 정보 유출이 될 수도 있다.
- 따라서 클라이언트에서 누가 누구인지를 구별할 단서를 보낸다.
- 서버는 그 단서를 파악하여 각 요청에 맞게 데이터를 전송한다.
## HTTP 요청에 대하여
- 현재 웹 모바일 서비스에서 가장 많이 사용하는 통신 방식은 **HTTP 통신**이다.
- HTTP 통신의 큰 특징에는 비 연결성과 무상태가 있다.
    -  **비연결성(Connectionless)** : 비연결성은 클라이언트와 서버가 한 번 연결을 맺은 후, 클 라이언트 요청에 대해 서버가 응답을 마치면 맺었던 연결을 끊어 버리는 성질을 말한다.
    - **무상태(Stateless)** : 연결을 끊어버리기 때문에, 클라이언트의 이전 상태를 알 수가 없다. 따라서 다른 페이지로 넘어갈 때마다 로그인을 다시 해야한다.
- 이러한 HTTP 특성 때문에 인증을 사용하여 HTTP 문제를 해결한다.
## 인증방식
1. 사용자 정보를 헤더에 담아서 전달하는 방식
    - 특징
        - 계정정보를 요청에 담아 보내는 방식이다.
        - 보통 HTTP 요청에 대한 HTTP메시지의 구조는 헤더와 바디 두 가지로 나뉘는데, 헤더에는 기본적으로 요청에 대한 정보가, 바디에는 서버로 보내야할 데이터가 들어가게된다.
        - 사용자 정보를 헤더에 담는 경우 HTTP 요청에 인증할 수단에 비밀번호를 넣는다.
    - 장점
        - 인증 방식을 고려 할 필요가 없다.
        - 인증 테스트를 할 때 빠르게 시도해볼 수 있다.
    - 단점
        - 보안에 취약하다.
        - 요청이 올 때마다 서버에서는 전달받은 데이터로 해당 유저가 맞는지 검증해야 하므로 비효율적이다.
2. 세션/쿠키 기반 인증 방식
    - 인증방식  
    ![](https://img1.daumcdn.net/thumb/R800x0/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F994BEA345B53368401)
        1. 클라이언트에서 로그인을 위해 정보를 서버에게 전달한다.
        2. 서버에서는 사용자 정보를 확인 후, 로그인 성공시 고유한 세션 ID값을 생성하여 메모리나 DB에 저장한다.
        3. 서버는 요청 결과값으로 세션 ID를 사용자에게 전달한다.
        4. 세션 ID를 전달받은 사용자는 쿠키를 해당 값을 저장한다.
        5. 이후 인증이 필요할 때마다 쿠키를 헤더에 실어서 보낸다.
        6. 서버는 쿠키를 받아서 세션 저장소에 저장된 쿠키(세션 ID)인지 확인한다.
        7. 유효한 쿠키(세션 ID)일 경우, 요청받은 데이터를 반환한다.
    - 특징
        - 세션 쿠키 방식의 인증은 기본적으로 세션 저장소를 필요하는데, 주로 Redis를 사용한다.
        - 만일 서버가 확장될 경우, 모든 서버가 세션 저장소에 접근할 수 있도록 중앙 세션 저장소 관리가 필요하다.
    - 장점
        - 쿠키가 포함된 요청이 외부에 노출되어도 쿠키는 유의미한 값을 갖고 않아 쿠기 자체로 큰 문제를 발생시키지 않는다.
        - 요청하는 사용자마다 고유한 세션 ID를 갖게 되므로 일일히 유저 정보를 확인할 필요가 없다.
    - 단점
        - 노출되는거 자체는 문제가 없으나 만일 해당 유저 A 이외의 다른 유저(해커)가 가로채어 변질된 내용으로 서버에 HTTP 요청을 보내면 서버는 해커의 요청을 A로 인식하게 된다.
            - 이를 방지하기 위해 세션에 유효시간을 추가하거나 HTTPS를 사용하여 안의 정보를 읽기 힘들게 한다.
        - 서버에서 세션 저장소를 사용하므로 추가적인 저장공간이 필요하다.
        - 중앙 세션 저장소 관리가 없으면 시스템 확장이 어렵다.
        - 중앙 세션 저장소에 장애가 발생하면 인증 전체에 문제가 될 수도 있다.
    ## 만일 세션을 사용하지 않고 쿠키만으로 인증을 하게 된다면
    - 사용자는 로그인을 하면 서버는 유저 정보를 암호화 또는 인코딩으로 변환하여 사용자에게 전달하고, 사용자는 이를 쿠키로 저장한다.
    - 그리고 인증이 필요할 때마다 이 쿠키를 헤더에 담아서 서버에 요청을 하고, 서버는 해당 쿠키를 복호화 또는 디코딩으로 풀어 사용한다.
    - 여기서 쿠키가 유의미한 값을 갖게된다면 외부에 노출될 경우 헤더에 사용자 정보를 전달하는 방식과 같은 문제가 띄게 된다.