# JWT(Json Web Token)
Jwt는 Json Web Token의 약자로 Json으로 된 Token을 사용하는 방식이다.  
Jwt는 인증에 필요한 정보들을 암호화 시킨 토큰을 뜻한다.  
사용자의 세션 상태를 저장하는게 아니라 필요한 정보를 토큰 body에 저장하여 사용자가 가지고 있고 그것을 증명처럼 사용한다.  
사용자는 Access Token(Jwt Token)을 HTTP헤더에 실어 서버에 보낸다.  

그런데 Jwt는 **토큰 자체가 의미를 갖는 claim 기반의 토큰** 방식이다.  
**claim(권한)** 은 사용자에 대한 프로퍼티나 속성을 의미한다.  
즉, Jwt는 아무 의미없는 문자열로 된 토큰이 아니다.

Token을 생성하고 요청하는 프로세스는 다음과 같다.
- Json 객체의 요구사항을 작성
- 어떠한 암호화 방식을 사용해서 문자열 인코딩
- HTTP header에 추가함으로써 사용자 인증을 요청
- 서버에서는 header에 추가된 Token을 디코딩하여 사용자를 인증함
## Jwt의 특징
1. 정보가 담긴 데이터(Json 객체)를 암호화 하여, HTTP 헤더에 추가시킨다.
    - 이로 인하여 보안성을 증가시킴
2. 권한을 부여하기 위해 필요한 데이터가 Jwt안에 모두 포함되어 있다.
    - 인증 서버에서 토큰에 대한 정보를 찾을 필요가 없다.

그렇다고 Jwt가 완벽한 것은 아니다.  
누군가 토큰을 탈취한다면, 그 토큰을 이용하여 권한을 수행할 수 있다.  
그래서 토큰을 서버에 저장하는 것이 아니기 때문에 **토큰 유효시간**을 설정해야 하며, 탈취 될 가능성을 줄이기 위해 **유효시간을 짧게 해주는 것**이 좋다.
## Jwt의 데이터 무결성 - HMAC
Jwt는 토큰이 탈취당하더라도 위변조의 위험을 벗어날 수 있도록 무결성을 보장하는 방법이 몇 가지 있다.  
그 방법 중 하나가 데이터를 암호화하고, 해싱하는 **HMAC**(Hash-based Message Authentication) 기법을 사용하는 것이다.  
**해싱**은 원문을 일정 길이의 byte로 변환하는데 그 결과가 유일하다는 특징이 있다.  
즉, 원문이 조금이라도 변하면 해싱의 결과는 완전히 달라진다.  
그래서 토큰을 탈취해서 수정하게 되면 해싱의 결과가 완전히 달라지므로 토큰이 위조되었다는걸 알 수 있다.
## Jwt의 구조 및 생성
토큰을 만들기 위해서는 Header(헤더), Payload(내용), Verify Signature(서명)가 필요하다.
1. 헤더(header)
    - typ
        - 토큰 타입을 명시한다.
    - alg
        - 해싱 알고리즘을 명시한다.
        - 이 알고리즘은 서버에서 토큰을 검증할 때 signatue에서 사용된다.

    Jwt인 토큰 유형이나 HMAC SHA256 또는 RSA와 같이 사용되는 해시 알고리즘이 무엇으로 사용했는지 등 정보가 담긴다.
2. 내용(payload)  
클라이언트에 대한 정보, META data같은 내용이 들어가 있고, Base64로 인코딩 되어 있다.  
토큰 정보는 속성, 값으로 표현되며 이를 claim이라 한다.
claim은 다음과 같이 3가지로 작성이 가능하다.  
    1. registered claim  
        미리 정의된 claim으로써, 토큰에 대한 정보를 작성한다.
        - iss
            - 토큰 발급자
        - exp
            - 토큰의 만료 시간
        - sub
            - 토큰 제목
        - 그 밖에 여러가지 존재
    2. public claim
        - 공개적인 claim을 명시하는데, 충돌방지를 위한 URI 형식으로 작성한다.
    3. private claim
        - 서버와 클라이언트가 협의한 claim을 명시한다.
3. 서명(verify Signature)  
    - Base64 방식으로 인코딩한 header, payload 그리고 secret key를 더한 후 서명된다.
    - 서명은 "."으로 연결하여 합친 후 비밀키로 해싱하는 것을 말한다.  

최종적인 형태는 Encoded Header + "." + Encoded Payload + "." + Verify Signatue 형태이다.(xxxx.yyyy.zzzz)