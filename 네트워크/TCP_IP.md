# TCP/IP
TCP/IP는 오늘날 데이터가 의도된 목적지로 닿을 수 있도록 보장해주는 프로토콜이다.  
TCP/IP는 TCP와 IP 두 가지의 프로토콜로 이루어져 있다.

TCP/IP는 가장 최근의 발명된 **컴퓨터와 컴퓨터**간의 지역 네트워크(LAN) 혹은 광역 네트워크(WAN)에서 원활한 통신을 가능하도록 하기 위한 통신 규약(Protocol)으로 정의할 수 있다.  
최초 미국방성에서 구축한 **ARPANET**에서 시작되었으며, 후에 미국방위통신청(DAC-Defense Communication Agency)에서 컴퓨터간 통신을 위해서 TCP/IP를 사용한 것이 그 시초가 되었다.

## TCP(Transmission Control Protocol)
두 호스트가 교환하는 데이터와 승인 메시지의 형식을 정의하여, 서버와 클라이언트간의 데이터를 신뢰성 있게 전달하기 위해 만들어진 규약이다.  
데이터를 전송하기 전에 데이타전송을 위한 연결을 만드는 연결지향 프로토콜이다.  
일반적으로 TCP와 IP를 함께 사용하는데, IP가 데이터의 배달을 처리한다면 TCP는 패킷을 추적 및 관리한다.  
인터넷 환경에서 기본적으로 사용하는 프로토콜이다.

컴퓨터와 컴퓨터를 이어주는 네트워크는 네트워크 선로를 통해 전달되는데, 이 선로는 광케이블일수도, 구리선일수도, 인공위성 일수도 있다.  
어떤 선로인지에 따라 데이터를 전달하는 속도와 손실되는 데이터의 양이 달라지는데, 이는 데이터를 전달하는 과정에서 그 순서가 의도하지 않게 뒤바뀌거나 손실이 되어 전달될 수 있음을 뜻한다.

TCP는 데이터 패킷에 일련의 번호를 부여함으로써, 데이터 손실을 찾아내서 교정하고, 순서를 재조합하여 클라이언트에게 전달할 수 있게 해준다.  
데이터를 수신하는 쪽에서는 순서를 재조합하여 데이터를 읽어들인다.

TCP의 장점은 복잡해서 신뢰성이 높다는 점이다.

## IP(Internet Protocol)
IP는 인터넷 상에서 사용되는 주소이다.  
컴퓨터와 컴퓨터간에 데이터를 전송하기 위해서, 각 컴퓨터의 주소가 필요하다.  
Internet Protocol은 4바이트로 이루어진 컴퓨터의 주소이며, 192.168.9.255와 같이 3개의 마침표로 나뉘어진 숫자로 표시된다.  
위 방식은 IPv4 방식이고 요즘은 스마트폰,태블릿, IOT 등 인터넷을 사용하는 기기가 너무 많아져서 IPv4방식의 아이피가 고갈되어 2001:0db8:85a3:08d3:1319:8a2e:0370:7334 처럼 IPv6 방식으로 전환 되고 있다.  
IP는 TCP와는 달리 데이터의 재조합이나 손실여부 확인이 불가능하며, 단지 데이터를 전달하는 역할만을 담당한다.

참고로 IP주소는 하드웨어 고유의 식별번호인 MAC주소와 다르게 임시적으로 다른 주체(통신사)에게 받는 주소이므로, 바뀔수 있다.

## TCP/IP의 특징
위 내용을 정리하면, IP기반에 TCP가 사용되서 TCP/IP라고 불리게 되었다.

TCP/IP는 4단계로 나뉘어져 있다(일부 사람들은 5단계로 나눈다고 한다).
![](https://image.slidesharecdn.com/1-181020073845/95/tcpip-4-1-638.jpg?cb=1540021147)
**4 - 응용(application) 계층  
3 - 전송(Transport) 계층  
2 - 인터넷(Internet) 계층  
1 - 네트워크(Network Access) 계층**  

상위 계층에서 하위 계층으로 내려오면서 해당하는 층을 식별할 수 있는 정보를 추가한 뒤 하위 계층으로 전송한다.  
데이터 전송을 위해 해당 층의 식별 데이터를 붙이는 것을 캡슐화(Encapsulation)라고 한다.
![](https://t1.daumcdn.net/cfile/tistory/99803C415BA2F07C06)
반대로 데이터를 전송 받아 해당 계층의 데이터를 떼어내는 것을 역캡슐화(Decapsulation)이라고 한다.
![](https://t1.daumcdn.net/cfile/tistory/995E84485BA2F3420F)

## TCP/IP 계층을 나누는 이유
프로토콜 계층화는 복잡한 여러 개의 작고 단순한 작업들로 나눌 수 있게해준다.  
계층화의 특징모듈성이다.  
즉, 각각의 계층을 여러개의 모듈로 생각하는 것이다.  
모듈성이 있으므로 서비스 분리, 전문화, 중간시스템의 통신이 가능하다.  
하나의 계층이 더 고장나더라도 시스템 전체를 바꾸지 않아도 되며 어느 계층이 고장났는지도 알기 쉽다.  
단점은 단순한 일이라도 복잡하게 나뉠 수 있다는 것이다.

프로토콜을 계층화할 때는 2가지 조건을 꼭 지켜줘야 한다.
1. 각 계층은 각 방향으로 한 가지씩, 상반되는 두 가지 작업을 수행할 수 있도록 만들어야 한다.
    - 한 쪽에서 메시지를 준다면, 다른 한 쪽에선 메시지를 받을 수 있어야 한다.
2. 양측의 각 계층에 있는 객체는 서로 동일해야 한다.
    - 한 쪽에 응용/전송/네트워크/링크/물리 층이 있으므로 반대 쪽도 차례대로 응용/전송/네트워크/링크/물리 층이 있어야 한다. 그래야 논리적으로 연결이 가능하다.

![](https://mblogthumb-phinf.pstatic.net/20161012_16/mes194_1476236745637fKg86_PNG/%C4%C4%B3%D71.PNG?type=w800)

## 네트워크 액세스 계층(Network Access Layer or Network Interface Layer)
**데이터 단위**: 프레임  
**전송 주소**: MAC  

이 계층은 Node-To-Node간의 신뢰성 있는 데이터 전송을 담당하는 계층이다.  
물리적으로 데이터가 네트워크를 통해 어떻게 전송되는지를 정의하는 계층이다.  
기본적으로 논리주소(IP주소 등)가 아닌 물리주소(MAC주소(Media Access Control Address))를 사용한다.  
여기서 MAC주소란 컴퓨터의 하드웨어 주소를 의미한다.

기본적으로 에러검출/패킷의 프레임화를 담당한다.  
프레임(Frame)단위의 데이터를 구성하는데, 최종적으로 데이터 전송을 하기 전 패킷헤더에 MAC주소와 오류 검출을 위한 부분을 첨부한다.

주로 MAC, LAN, 패킷망 등에 사용되며 LAN 상에서는 Ehternet(이더넷), Token Ring, FDDI 등이 있고 WAN 상에서는 X.25, Frame Relay, PPP 등이 있다.

## 인터넷 계층(Internet Layer)
**데이터 단위**: 패킷  
**전송 주소**: IP

네트워크상 최종 목적지까지 정확하게 연결되도록 연결성을 제공한다.  
통신 노드간의 IP패킷을 전송하는 기능과 라우팅 기능을 담당한다.

라우팅(Routing) 기능을 제공하여 경로를 설정한다.  
단말을 구분하기 위해 논리적인 주소(Logical Address) IP를 할당하는데, 이는 출발지와 목적지의 논리 주소가 담겨있는 IP datagram이라는 패킷으로 데이터를 변경한다.  
또한 데이터 전송을 위한 주소를 지정한다.

세그먼트를 목적지까지 전송하기 위해 시작 주소와 목적지의 논리적 주소를 붙여 패킷 단위의 데이터를 구성한다. **데이터 + IP Header**

인터넷 계층에서 동작하는 대표적인 프로토콜은 다음과 같다.
- IP(Internet Protocol): 비신뢰성, 비연결지향 데이터그램 프로토콜이다.
-  ARP(Address Resolution Protocol) : 주소변환 프로토콜이다. IP주소를 MAC주소로 변환하는 프로토콜이다.
- RARP(Reverse ARP) : 반대로 MAC주소로 IP주소를 찾는 프로토콜이다.
- ICMP(Internet Control Message Protocol) : 상태 진단 메시지 프로토콜이다. 이 프로토콜을 이용하는 대표적인 프로그램이 ping이다.
- IGMP(Internet Group Message Protocol) : 멀티캐스트용 프로토콜이다.

이 이외에도 OSPF, BGP 등이 존재한다.

## 전송 계층(Transport Layer)
**데이터 단위**: Segment  
**전송 주소**: Port

프로세스간의 신뢰성 있는 데이터 전송을 담당하는 계층이다.  
통신 노드간의 연결 제어 및 자료 송수신을 담당하며, 어플리케이션 계층의 세션과 데이터그램 통신 서비스를 제공한다.

세그먼트 (Segment)단위의 데이타 구성하는데, 실질적인 데이터 전송을 위해 데이타를 일정 크기로 나눈 것이라고 할 수 있다.  
발신, 수신, 포트주소, 오류검출코드가 붙게된다.

process-to-process 전송을 담당하기 위해서는 논리적 주소가 필요한데, process가 사용하는 포트 번호를 그 논리적 주소로 사용한다.

전송 계층에서 사용되는 대표적인 프로토콜은 다음과 같다.
- TCP(Transmission Control Protocol): 신뢰성 있는 연결지향형 프로토콜이다. 해당 패킷에 대해 오류처리나 재전송 따위로에러를 복구하는 것을 신뢰성 있다고 한다. 이로 인해 TCP의 헤더에는 붙는 정보가 많다.
- UDP(User Datagram Protocol): 비신뢰성 비연결형 프로토콜이다. 패킷을 잃거나 오류가 있어도 대처하지 않는 것을 말한다. 그래서 UDP 헤더는 간단한 구조를 지닌다.

이 이외에도 RTP, RTCP 등이 존재한다.

## 응용 계층(Application Layer)
**데이터 단위**: Data/Message

사용자와 가장 가까운 계층으로 사용자가 소프트웨어 application과 소통할 수 있게 해주는 계층이다.  
응용프로그램(application)들이 데이터를 교환하기 위해 사용되는 프로토콜이다.  
사용자 응용프로그램 인터페이스를 담당한다.

TCP/UDP 기반의 응용 프로그램을 구현할 때 사용한다.  
브라우저나 텔넷같은 서비스가 이 계층에 동작하며, 동작하기 위해서는 전송계층의 주소, 즉 포트번호를 사용한다.

응용 계층에서 사용되는 대표적인 프로토콜은 다음과 같다.
-  HTTP (Hyper-Text Transfer Protocol) : TCP기반의 프로토콜로 포트번호 80번을 사용한다.
- Telnet : TCP 포트번호 23번을 사용한다. 원격 터미널을 접속할때 이 포로토콜을 사용한다.
- SSH (Secure Shell) : 텔넷과 같은 서비스는 보안에 취약하다. 비밀번호가 암호화되지 않아 그대로 노출이 되기 때문에, 이것을 보완한것이 SSH이다. 포트번호 22번을 사용한다.
- FTP(File Transfer Protocol) : 파일 전송 프로토콜이다. 파일을 받거나 올릴때 FTP를 사용한다. FTP는 파일을 올리거나 내려받을때 신뢰성을 중요시하기 때문에 TCP에서 동작하고, 2개의 포트를 사용한다. TCP 포트 20번은 데이터 전송을 위한 용도, TCP 포트 21번은 제어용으로 사용한다.
- SMTP (Simple Mail Transfer Protocol) : 메일 전송 프로토콜이다. TCP 상에서 동작하며 포트는 25번을 사용한다.
- POP3 (Post Office Protocol Version3) : 메일 수신용 프로토콜이다. 아웃룩같은 프로그램이 POP3라는 프로토콜을 사용하여 동작한다. TCP 포트 110번을 사용합니다.
- DNS (Domain Name System) : 도메인명에 대한 호스트 정보를 제공해준다. 기본적으로 UDP상에서 동작한다. 기본적으로 실패하면 다시 한번 요청하면 되며 그렇게 중요한 정보가 아니지만, 신뢰성을 요할 경우에는 TCP상에서도 동작한다. 데이터의 길이가 길 경우같은 때 TCP 기반으로 동작할 수 있다. UDP, TCP 포트 53번을 사용한다.

![image](https://user-images.githubusercontent.com/52641909/111316945-08c94280-86a7-11eb-9ee2-c8c0d06263ae.png)